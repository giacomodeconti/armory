# Attacking Wordpress

## Brute Force wp-login.php Form

The most common attack against the WordPress user is brute forcing the password of an account to gain access to the back-end of the WordPress system. Other ways a password can be compromised include sniffing the password in clear text over a HTTP login session or even getting the credentials from a key logger on the workstation of the WordPress administrator.

Accounts with administrator level access are the most sought after due to the amount of mischief an admin user can get up to; adding PHP command shells or malicious javascript directly through admin interface are common examples.

With the usernames we collected during information gathering we can get started (or just try admin). Take a look at the login form /wp-login.php, notice how failed logins confirm the username when an incorrect password is entered. This is very helpful to an attacker.... it also makes things more user friendly for the end user who has forgotten their username and password. This "feature" has been debated and it has been decided to keep this response within the WordPress code.

## WPScan

The previously mentioned WPScan tool in addition to enumeration, can also perform brute force login attacks.

Here is an example output from a test I ran with WPScan against a low end Digital Ocean VPS ($5 / month) where I had installed a default installation of WordPress.

	ruby wpscan.rb -u 192.241.xx.x68 --threads 20 --wordlist 500worst.txt --username testadmin

	[+] Starting the password brute forcer

  	Brute forcing user 'testadmin' with 500 passwords... 100% complete.
	
	[+] Finished at Thu Jul 20 03:39:02 2013
	[+] Elapsed time: 00:01:16

## Nmap NSE

Nmap the port scanner can do much more than find open ports. Recent versions of Nmap come bundled with NSE scripts that can be used to test many different vulnerabilities; including enumerating users and brute forcing WordPress passwords.

	nmap -sV --script http-wordpress-enum --script-args limit=25 

	PORT   STATE SERVICE REASON
	80/tcp open  http    syn-ack
	| http-wordpress-enum: 
	| Username found: admin
	| Username found: testadmin
	| Username found: fred
	| Username found: alice
	| Username found: bob
	|_Search stopped at ID #25. Increase the upper limit if necessary with 'http-wordpress-enum.limit'

## Brute Force Login via xmlrpc.php

The xmlrpc.php capability is an API endpoint that allows mobile apps and other programmable access to backend functions of the WordPress site such as publishing posts. It is enabled by default and several attacks are possible against the endpoint depending on permissions and the version of the target WordPress installation.

By using the xmlrpc.php endpoint to attack WordPress accounts we may bypass security plugins that are protecting the login form from abuse. This password guessing attack may also be faster, with the result being you can attempt more passwords.

Notice the -d, in curl this is the data that is sent as part of the POST request. You could also use Burp or your favorite scripting language for this request.

	curl -X POST -d "<methodCall><methodName>wp.getUsersBlogs</methodName><params> 
	<param><value>admin</value></param><param><value>pass</value></param></params></methodCall>" http://examplewp.com/xmlrpc.php

In the response we will see an invalid password response or success. It is easy to spot and work into your script. 


## Exploit WordPress Plugin

Plugins, Themes and WordPress Core all contain a large amount of PHP code from developers around the world. These developers have differing abilities and focus when it comes to writing secure software. For this reason, there are thousands of exploitable vulnerabilities available to an attacker. Updating plugins, the WordPress core, and themes must be a routine task for any WordPress administrator to ensure the known vulnerabilities are patched.

Common vulnerabilities include XSS, SQL injection, file upload, and code execution. All of these can have devastating consequences to a WordPress site. Search through Metasploit and exploit-db.com for exploitable WordPress bugs.

## Exploit WordPress Themes

Exploits are available from various places and forums. This example uses an exploit from the popular Metasploit Exploitation Framework. The vulnerable theme is the very popular optimizepress. The vulnerability was released back in 2013 and versions after 1.45 are not vulnerable to this exploit.

Using standard Metasploit commands, we can load the module, configure the options, select a payload and exploit. The result is shell access on the server with only a few minutes work.

In this example, the vulnerability type is a file upload vulnerability in media-upload.php of the theme. By exploiting the vulnerability we can upload a PHP shell or other code, giving us code execution.

WordPress Metasploit File Upload Example

The key point to remember here is - identification of the plugins and themes is the first step in a targeted attack exploiting a WordPress site.

Numerous bots and automated attack scripts that exploit WordPress sites do not perform the enumeration phase, they simply propel exploits at thousands of sites and hope for a successful payload.

Plugins and themes not enabled can be exploited. Scanning for default locations of those vulnerable files is a highly common attack by automated bots..
